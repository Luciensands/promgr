<div class="row">
  <% if current_user.is_manager? %>
    <%= render 'shared/sidebar_manager' %>
  <% else %>
    <%= render 'shared/sidebar_employee' %>
  <% end %>
  <div class="col mx-5 my-4 text-light">
    <h1>Calendar/Tasks</h1>
    <%= month_calendar(attribute: :due_date, events: @tasks) do |date, tasks| %>
      <div class="d-flex flex-column">
        <%= date.day %>
        <% tasks.each do |task| %>
          <p class="badge rounded-pill text-bg-light"><%= task.task_title %></p>
        <% end %>
      </div>
    <% end %>
    <div class="boxes p-3 text-light">
      <h2>Task List</h2>
      <div class="container d-flex flex-column gap-3">
        <% @tasks.order(:due_date).each do |task| %>
          <%= render 'tasks/edittaskform', task: task %>
          <div class="row rounded text-dark bg-light">
            <div class="col d-flex align-items-center justify-content-between p-1">
              <div>
                <div><b><%= task.task_title %></b></div>
                <div>Due: <%= task.due_date.to_s.split(" ")[0] %> &nbsp; <%= task.status %></div>
              </div>
              <div class="d-flex flex-row align-items-center justify-content-end">
                <div>
                  <% task.users.each do |user| %>
                    <% if user.photo.attached? %>
                      <%= cl_image_tag user.photo.key, class: "avatar-bordered" %>
                    <% else %>
                      <%= image_tag "https://res.cloudinary.com/wagon/image/upload/c_fill,g_face,h_200,w_200/v1673190740/pyp2lkzx5ec4awqextwq.jpg", class: "avatar-bordered shadow" %>
                    <% end %>
                  <% end %>
                </div>
                <div>
                  <button class="btn btn-dark  mx-1" data-bs-toggle="offcanvas" data-bs-target=<%="#taskmodel#{task.id}"%> aria-controls="offcanvasExample">Edit</button>
                </div>
                <div>
                  <%= link_to "Delete", task_path(task), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },class: "btn btn-dark"%>
                </div>
                <div>
                  <%= simple_form_for task,data: {action: "submit->insert-in-list#update"} do |f| %>
                    <%= f.input :status, as: :hidden, input_html: { value: 'done'} %>
                    <%= f.submit 'Done', class: "btn btn-dark mb-3 ms-1" %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
